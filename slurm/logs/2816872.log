Tue Dec 19 16:15:20 2023       
+---------------------------------------------------------------------------------------+
| NVIDIA-SMI 535.104.05             Driver Version: 535.104.05   CUDA Version: 12.2     |
|-----------------------------------------+----------------------+----------------------+
| GPU  Name                 Persistence-M | Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp   Perf          Pwr:Usage/Cap |         Memory-Usage | GPU-Util  Compute M. |
|                                         |                      |               MIG M. |
|=========================================+======================+======================|
|   0  Tesla V100-SXM2-32GB           On  | 00000000:1D:00.0 Off |                    0 |
| N/A   29C    P0              40W / 300W |      0MiB / 32768MiB |      0%      Default |
|                                         |                      |                  N/A |
+-----------------------------------------+----------------------+----------------------+
                                                                                         
+---------------------------------------------------------------------------------------+
| Processes:                                                                            |
|  GPU   GI   CI        PID   Type   Process name                            GPU Memory |
|        ID   ID                                                             Usage      |
|=======================================================================================|
|  No running processes found                                                           |
+---------------------------------------------------------------------------------------+
/beegfs/scratch/user/drau/research/reml/run.py:10: UserWarning: 
The version_base parameter is not specified.
Please specify a compatability version level, or None.
Will assume defaults for version 1.1
  @hydra.main(config_path="config", config_name=CONFIG_NAME)
/home/drau/rag/lib/python3.10/site-packages/hydra/_internal/defaults_list.py:251: UserWarning: In 'rag': Defaults list is missing `_self_`. See https://hydra.cc/docs/1.2/upgrades/1.0_to_1.1/default_composition_order for more information
  warnings.warn(msg, UserWarning)
2023-12-19 16:15:29.132413: I tensorflow/core/util/port.cc:113] oneDNN custom operations are on. You may see slightly different numerical results due to floating-point round-off errors from different computation orders. To turn them off, set the environment variable `TF_ENABLE_ONEDNN_OPTS=0`.
2023-12-19 16:15:29.751521: E external/local_xla/xla/stream_executor/cuda/cuda_dnn.cc:9261] Unable to register cuDNN factory: Attempting to register factory for plugin cuDNN when one has already been registered
2023-12-19 16:15:29.751742: E external/local_xla/xla/stream_executor/cuda/cuda_fft.cc:607] Unable to register cuFFT factory: Attempting to register factory for plugin cuFFT when one has already been registered
2023-12-19 16:15:29.873470: E external/local_xla/xla/stream_executor/cuda/cuda_blas.cc:1515] Unable to register cuBLAS factory: Attempting to register factory for plugin cuBLAS when one has already been registered
2023-12-19 16:15:30.106476: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: AVX2 AVX512F AVX512_VNNI FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-12-19 16:15:32.287774: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Could not find TensorRT
retriever_config:
  model_name: retromae
  batch_size: 10240
  batch_size_sim: 256
  top_k_documents: 3
  pyserini_num_threads: 20
dataset_config:
  train:
    doc: null
    query: null
  test:
    doc:
    - odqa-wiki-corpora-100w-karpukhin
    - train
    query:
    - nq_open
    - validation
  dev:
    doc: null
    query: null
run_name: encode
dataset_folder: datasets/
index_folder: indexes/
experiment_folder: experiments/
processing_num_proc: 30
overwrite_datasets: false
debug: false

[2023-12-19 16:15:36,479][absl][INFO] - Using /tmp/tfhub_modules to cache modules.
[2023-12-19 16:15:36,481][absl][INFO] - Downloading TF-Hub Module 'https://tfhub.dev/google/answer_equivalence/bem/1'.
[2023-12-19 16:15:52,500][absl][INFO] - Downloading https://tfhub.dev/google/answer_equivalence/bem/1: 61.56MB
[2023-12-19 16:16:08,515][absl][INFO] - Downloading https://tfhub.dev/google/answer_equivalence/bem/1: 111.56MB
[2023-12-19 16:16:26,359][absl][INFO] - Downloading https://tfhub.dev/google/answer_equivalence/bem/1: 171.56MB
[2023-12-19 16:16:42,384][absl][INFO] - Downloading https://tfhub.dev/google/answer_equivalence/bem/1: 221.56MB
[2023-12-19 16:16:58,381][absl][INFO] - Downloading https://tfhub.dev/google/answer_equivalence/bem/1: 271.56MB
[2023-12-19 16:17:13,485][absl][INFO] - Downloading https://tfhub.dev/google/answer_equivalence/bem/1: 321.56MB
[2023-12-19 16:17:29,498][absl][INFO] - Downloading https://tfhub.dev/google/answer_equivalence/bem/1: 371.56MB
[2023-12-19 16:17:45,487][absl][INFO] - Downloading https://tfhub.dev/google/answer_equivalence/bem/1: 421.56MB
[2023-12-19 16:17:45,489][absl][INFO] - Downloaded https://tfhub.dev/google/answer_equivalence/bem/1, Total size: 421.60MB
[2023-12-19 16:17:45,490][absl][INFO] - Downloaded TF-Hub Module 'https://tfhub.dev/google/answer_equivalence/bem/1'.
2023-12-19 16:17:46.546036: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1929] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 31141 MB memory:  -> device: 0, name: Tesla V100-SXM2-32GB, pci bus id: 0000:1d:00.0, compute capability: 7.0
[2023-12-19 16:17:48,604][absl][INFO] - Fingerprint not found. Saved model loading will continue.
[2023-12-19 16:17:48,605][absl][INFO] - path_and_singleprint metric could not be logged. Saved model loading will continue.
Processing dataset: odqa-wiki-corpora-100w-karpukhin
Processing dataset: nq_open
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
RAG Model:
Retriever: retromae
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

BertModel(
  (embeddings): BertEmbeddings(
    (word_embeddings): Embedding(30522, 768, padding_idx=0)
    (position_embeddings): Embedding(512, 768)
    (token_type_embeddings): Embedding(2, 768)
    (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
    (dropout): Dropout(p=0.1, inplace=False)
  )
  (encoder): BertEncoder(
    (layer): ModuleList(
      (0-11): 12 x BertLayer(
        (attention): BertAttention(
          (self): BertSelfAttention(
            (query): Linear(in_features=768, out_features=768, bias=True)
            (key): Linear(in_features=768, out_features=768, bias=True)
            (value): Linear(in_features=768, out_features=768, bias=True)
            (dropout): Dropout(p=0.1, inplace=False)
          )
          (output): BertSelfOutput(
            (dense): Linear(in_features=768, out_features=768, bias=True)
            (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
            (dropout): Dropout(p=0.1, inplace=False)
          )
        )
        (intermediate): BertIntermediate(
          (dense): Linear(in_features=768, out_features=3072, bias=True)
          (intermediate_act_fn): GELUActivation()
        )
        (output): BertOutput(
          (dense): Linear(in_features=3072, out_features=768, bias=True)
          (LayerNorm): LayerNorm((768,), eps=1e-12, elementwise_affine=True)
          (dropout): Dropout(p=0.1, inplace=False)
        )
      )
    )
  )
  (pooler): BertPooler(
    (dense): Linear(in_features=768, out_features=768, bias=True)
    (activation): Tanh()
  )
)
cuda
Error executing job with overrides: ['+run_name=encode']
Traceback (most recent call last):
  File "/beegfs/scratch/user/drau/research/reml/run.py", line 29, in main
    rag = RAG(**config)
  File "/beegfs/scratch/user/drau/research/reml/rag.py", line 49, in __init__
    self.retriever = Retrieve(
  File "/beegfs/scratch/user/drau/research/reml/retrieve.py", line 44, in __init__
    self.model = retriever_class(model_name=self.model_name)
  File "/beegfs/scratch/user/drau/research/reml/models/retrievers/retromae.py", line 12, in __init__
    self.model = self.model.to(self.device)
  File "/home/drau/rag/lib/python3.10/site-packages/transformers/modeling_utils.py", line 2460, in to
    return super().to(*args, **kwargs)
  File "/home/drau/rag/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1160, in to
    return self._apply(convert)
  File "/home/drau/rag/lib/python3.10/site-packages/torch/nn/modules/module.py", line 810, in _apply
    module._apply(fn)
  File "/home/drau/rag/lib/python3.10/site-packages/torch/nn/modules/module.py", line 810, in _apply
    module._apply(fn)
  File "/home/drau/rag/lib/python3.10/site-packages/torch/nn/modules/module.py", line 833, in _apply
    param_applied = fn(param)
  File "/home/drau/rag/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1158, in convert
    return t.to(device, dtype if t.is_floating_point() or t.is_complex() else None, non_blocking)
NotImplementedError: Cannot copy out of meta tensor; no data!

Set the environment variable HYDRA_FULL_ERROR=1 for a complete stack trace.
